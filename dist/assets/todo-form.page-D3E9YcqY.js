import{J as v,aE as L,aF as G,aG as M,f as U,a as D,j as c,u as W,y as k,S as O,G as Y,x as q,o as J}from"./index-BHNp474o.js";import{u as V,a as X,C as Z,o as K,n as Q,s as T,_ as ee}from"./schemas-Bl1Lw-Vl.js";import{P as E}from"./primary.button-B0N-mZMw.js";import{T as H}from"./TextInput-CHlh6L20.js";import{g as te,S as re}from"./Select-xjuUw3lp.js";import{a as B}from"./InputBase-BeZN-MFe.js";import{d as oe,e as ie,f as ne}from"./todo.hooks-Cd_V3NLm.js";import{P as ae}from"./page.layout-D3elAzk0.js";import{T as se,C as de}from"./Title-K7XM02dH.js";var ue=v.useLayoutEffect,ce=function(r){var e=L.useRef(r);return ue(function(){e.current=r}),e},F=function(r,e){if(typeof r=="function"){r(e);return}r.current=e},le=function(r,e){var t=L.useRef();return L.useCallback(function(i){r.current=i,t.current&&F(t.current,null),t.current=e,e&&F(e,i)},[e])},I={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},fe=function(r){Object.keys(I).forEach(function(e){r.style.setProperty(e,I[e],"important")})},P=fe,u=null,_=function(r,e){var t=r.scrollHeight;return e.sizingStyle.boxSizing==="border-box"?t+e.borderSize:t-e.paddingSize};function he(o,r,e,t){e===void 0&&(e=1),t===void 0&&(t=1/0),u||(u=document.createElement("textarea"),u.setAttribute("tabindex","-1"),u.setAttribute("aria-hidden","true"),P(u)),u.parentNode===null&&document.body.appendChild(u);var i=o.paddingSize,s=o.borderSize,a=o.sizingStyle,m=a.boxSizing;Object.keys(a).forEach(function(h){var d=h;u.style[d]=a[d]}),P(u),u.value=r;var n=_(u,o);u.value=r,n=_(u,o),u.value="x";var l=u.scrollHeight-i,f=l*e;m==="border-box"&&(f=f+i+s),n=Math.max(f,n);var p=l*t;return m==="border-box"&&(p=p+i+s),n=Math.min(p,n),[n,l]}var N=function(){},me=function(r,e){return r.reduce(function(t,i){return t[i]=e[i],t},{})},pe=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],ge=!!document.documentElement.currentStyle,ve=function(r){var e=window.getComputedStyle(r);if(e===null)return null;var t=me(pe,e),i=t.boxSizing;if(i==="")return null;ge&&i==="border-box"&&(t.width=parseFloat(t.width)+parseFloat(t.borderRightWidth)+parseFloat(t.borderLeftWidth)+parseFloat(t.paddingRight)+parseFloat(t.paddingLeft)+"px");var s=parseFloat(t.paddingBottom)+parseFloat(t.paddingTop),a=parseFloat(t.borderBottomWidth)+parseFloat(t.borderTopWidth);return{sizingStyle:t,paddingSize:s,borderSize:a}},be=ve;function R(o,r,e){var t=ce(e);v.useLayoutEffect(function(){var i=function(a){return t.current(a)};if(o)return o.addEventListener(r,i),function(){return o.removeEventListener(r,i)}},[])}var xe=function(r,e){R(document.body,"reset",function(t){r.current.form===t.target&&e(t)})},Se=function(r){R(window,"resize",r)},ye=function(r){R(document.fonts,"loadingdone",r)},ze=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Te=function(r,e){var t=r.cacheMeasurements,i=r.maxRows,s=r.minRows,a=r.onChange,m=a===void 0?N:a,n=r.onHeightChange,l=n===void 0?N:n,f=G(r,ze),p=f.value!==void 0,h=v.useRef(null),d=le(h,e),C=v.useRef(0),S=v.useRef(),b=function(){var g=h.current,z=t&&S.current?S.current:be(g);if(z){S.current=z;var j=he(z,g.value||g.placeholder||"x",s,i),x=j[0],A=j[1];C.current!==x&&(C.current=x,g.style.setProperty("height",x+"px","important"),l(x,{rowHeight:A}))}},$=function(g){p||b(),m(g)};return v.useLayoutEffect(b),xe(h,function(){if(!p){var y=h.current.value;requestAnimationFrame(function(){var g=h.current;g&&y!==g.value&&b()})}}),Se(b),ye(b),v.createElement("textarea",M({},f,{onChange:$,ref:d}))},Le=v.forwardRef(Te);const Re={size:"sm"},w=U((o,r)=>{const{autosize:e,maxRows:t,minRows:i,__staticSelector:s,resize:a,...m}=D("Textarea",Re,o),n=e&&te()!=="test",l=n?{maxRows:t,minRows:i}:{};return c.jsx(B,{component:n?Le:"textarea",ref:r,...m,__staticSelector:s||"Textarea",multiline:!0,"data-no-overflow":e&&t===void 0||void 0,__vars:{"--input-resize":a},...l})});w.classes=B.classes;w.displayName="@mantine/core/Textarea";const we=K({title:T().min(3,"Titre trop court"),description:T().min(10,"Description trop courte"),priority:ee(["low","medium","high"]),dueDate:T(),todoListId:Q()}),Ce=({todoId:o,todoListId:r,initialData:e,onSubmit:t,isSubmitting:i=!1})=>{const{register:s,handleSubmit:a,control:m,formState:{errors:n},reset:l}=V({resolver:X(we),defaultValues:{todoListId:r,priority:"medium",title:"",description:"",dueDate:""}}),{t:f}=W(),p=k(),h=()=>{p(-1)};return v.useEffect(()=>{e&&l({title:e.title,description:e.description,priority:e.priority,dueDate:e.dueDate,todoListId:e.todoListId})},[e,l]),c.jsx("form",{onSubmit:a(t),children:c.jsxs(O,{children:[c.jsx(H,{label:"Titre",placeholder:"Titre de la tâche",...s("title"),error:n.title?.message}),c.jsx(w,{label:"Description",placeholder:"Description de la tâche",rows:4,...s("description"),error:n.description?.message}),c.jsx(Z,{name:"priority",control:m,render:({field:d})=>c.jsx(re,{label:"Priorité",data:[{value:"low",label:"Basse"},{value:"medium",label:"Moyenne"},{value:"high",label:"Haute"}],...d,error:n.priority?.message})}),c.jsx(H,{label:"Date limite",type:"date",...s("dueDate"),error:n.dueDate?.message}),c.jsxs(Y,{justify:"center",children:[c.jsx(E,{label:f("actions.cancel"),type:"button",variant:"light",loading:i,onClick:h}),c.jsx(E,{label:f(o?"actions.edit":"actions.create"),type:"submit",loading:i})]})]})})},ke=()=>{const{t:o}=W(),r=k(),{todoListId:e,todoId:t}=q(),i=J(d=>d.currentUser),{data:s}=oe(t?Number(t):0),{mutate:a,isPending:m}=ie(),{mutate:n,isPending:l}=ne(),f=async d=>{a(d,{onSuccess:()=>{r(`/user/${i?.id}/todo-lists/${e}/todos`)}})},p=async d=>{t&&n({todoId:Number(t),data:d},{onSuccess:()=>{r(`/user/${i?.id}/todo-lists/${e}/todos`)}})},h=async d=>{t?await p(d):await f(d)};return c.jsxs(ae,{children:[c.jsx(se,{order:1,size:"h2",mb:"xs",className:"text-center",children:o(t?"titles.edit_todo":"titles.create_todo")}),c.jsx(de,{size:700,children:c.jsx(Ce,{todoId:t?Number(t):void 0,todoListId:Number(e),initialData:s,onSubmit:h,isSubmitting:m||l})})]})};export{ke as default};
